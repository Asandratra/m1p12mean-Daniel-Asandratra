"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[105],{6105:(V,c,i)=>{i.r(c),i.d(c,{ClientDemandesRendezVousComponent:()=>E});var u=i(5447),_=i(177),o=i(4341),l=i(8939),e=i(4438),p=i(6961),D=i(2910);function R(a,d){if(1&a&&(e.j41(0,"p",3),e.EFF(1),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.JRh(t.errorMessage)}}function h(a,d){if(1&a){const t=e.RV6();e.j41(0,"td",10)(1,"form",11),e.bIt("ngSubmit",function(){e.eBV(t);const n=e.XpG().$implicit,r=e.XpG();return e.Njj(r.confirmRDV(n._id))}),e.j41(2,"button",13),e.EFF(3,"Confirmer"),e.k0s()()()}}function g(a,d){if(1&a){const t=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.nI1(3,"date"),e.k0s(),e.j41(4,"td",7),e.EFF(5),e.k0s(),e.j41(6,"td",7),e.EFF(7),e.k0s(),e.j41(8,"td",10)(9,"form",11),e.bIt("ngSubmit",function(){const n=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.refusRDV(n._id))}),e.j41(10,"button",12),e.EFF(11,"Annuler"),e.k0s()()(),e.DNE(12,h,4,0,"td",10),e.k0s()}if(2&a){const t=d.$implicit,s=e.XpG();e.R7$(2),e.JRh(e.i5U(3,4,t.dateHeure,"dd/MM/yyyy \xe0 HH:mm")),e.R7$(3),e.SpI("Garage ",t.idGarage.localisation,""),e.R7$(2),e.JRh(s.status[t.status]),e.R7$(5),e.vxM(1==t.status?12:-1)}}let E=(()=>{class a{constructor(t,s,n){this.demandeRDVService=t,this.rendezvousService=s,this.activatedRoute=n,this.errorMessage="",this.demandesRDV=[],this.status=["En attente","En confirmation","Confirm\xe9e","Refus\xe9e"],this.page=0,this.nombreElement=0,this.nombreMaxElement=0,this.pageMax=0}ngOnInit(){this.currentUser=JSON.parse(sessionStorage.getItem("currentUser")),this.activatedRoute.params.subscribe(t=>{this.page=t.page,this.loadDemandesRDV(this.page)})}loadDemandesRDV(t){this.demandeRDVService.filterDemandesRDV(t,{idClient:this.currentUser._id,status:{$lt:2}}).subscribe(n=>{this.nombreElement=n.nombreElement,this.nombreMaxElement=n.nombreMaxElement,this.pageMax=n.pageMax,this.demandesRDV=n.demandesRDV})}createRendezVous(t){this.errorMessage="",this.demandeRDVService.getDemandesRDVByid(t).subscribe(s=>{this.rendezvousService.addDemandeRDV({idClient:s.idClient,idGarage:s.idGarage,dateHeure:s.dateHeure,status:0}).subscribe(r=>{},r=>{this.errorMessage=r.message})},s=>{this.errorMessage=s.message})}updateStatusDemandeRDV(t,s){this.demandeRDVService.updateDemandeRDV(t,{status:s}).subscribe(r=>{this.activatedRoute.params.subscribe(m=>{this.page=m.page,this.loadDemandesRDV(this.page)},m=>{this.errorMessage=m.message})},r=>{this.errorMessage=r.message})}confirmRDV(t){this.createRendezVous(t),this.updateStatusDemandeRDV(t,2)}refusRDV(t){this.updateStatusDemandeRDV(t,3)}static{this.\u0275fac=function(s){return new(s||a)(e.rXU(p.y),e.rXU(D.N),e.rXU(u.nX))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-client-demandes-rendez-vous"]],decls:23,vars:4,consts:[[1,"card","d-flex","justify-content-center"],[1,"card-body","col-x1-12"],[1,"mb-4"],[1,"text","text-danger"],[1,"card","tbl-card"],[1,"table-responsive"],[1,"table","table-hover","mb-0",2,"font-size","larger"],[1,"text-center"],[1,"d-flex","justify-content-end"],[3,"page","pageMax","url"],[1,"text-end"],[3,"ngSubmit"],["type","submit",1,"btn","btn-danger"],["type","submit",1,"btn","btn-primary"]],template:function(s,n){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"h5",2),e.EFF(3,"Mes Demandes de Rendez-Vous"),e.k0s(),e.DNE(4,R,2,1,"p",3),e.j41(5,"div",4)(6,"div",5)(7,"table",6)(8,"thead")(9,"tr")(10,"th"),e.EFF(11,"DATE DEMANDEE"),e.k0s(),e.j41(12,"th",7),e.EFF(13,"GARAGE"),e.k0s(),e.j41(14,"th",7),e.EFF(15,"ETAT"),e.k0s(),e.nrm(16,"th")(17,"th"),e.k0s()(),e.j41(18,"tbody"),e.Z7z(19,g,13,7,"tr",null,e.fX1),e.k0s()()()(),e.j41(21,"div",8),e.nrm(22,"app-pagination",9),e.k0s()()()),2&s&&(e.R7$(4),e.vxM(n.errorMessage?4:-1),e.R7$(15),e.Dyx(n.demandesRDV),e.R7$(3),e.Y8G("page",n.page)("pageMax",n.pageMax)("url","/client/demandes-rendez-vous"))},dependencies:[u.iI,_.MD,_.vh,o.YN,o.qT,o.cb,o.cV,l.e],encapsulation:2})}}return a})()}}]);