"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[60],{5060:(R,v,r)=>{r.r(v),r.d(v,{ManagerDetailsTravauxComponent:()=>D});var h=r(5447),m=r(177),l=r(4341),p=r(7482),e=r(4438),u=r(8737),g=r(3878),f=r(3131),M=r(2525),E=r(1626);let F=(()=>{class n{constructor(t){this.http=t,this.apiURL=`${M.c.apiUrl}/payements`}addPaiement(t){return this.http.post(this.apiURL,t)}static{this.\u0275fac=function(a){return new(a||n)(e.KVO(E.Qq))}}static{this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function S(n,c){if(1&n&&(e.j41(0,"p",18),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.JRh(t.paiementError)}}function j(n,c){if(1&n&&(e.j41(0,"p",18),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.JRh(t.serviceError)}}function T(n,c){if(1&n&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td",29),e.EFF(4),e.k0s(),e.j41(5,"td",29),e.EFF(6),e.nI1(7,"number"),e.k0s()()),2&n){const t=c.$implicit;e.R7$(2),e.JRh(t.label),e.R7$(2),e.SpI("",t.duree," mn"),e.R7$(2),e.SpI("Ar ",e.bMT(7,3,t.prix),"")}}function b(n,c){if(1&n&&(e.j41(0,"p",18),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.JRh(t.mecanoError)}}function C(n,c){if(1&n&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s()()),2&n){const t=c.$implicit;e.R7$(2),e.Lme("",t.nom," ",t.prenom,"")}}let D=(()=>{class n{constructor(t,a,i,o,d){this.activatedRoute=t,this.serviceService=a,this.employeeService=i,this.travailService=o,this.paiementService=d,this.serviceError="",this.mecanoError="",this.paiementError="",this.initPaiement={idTravail:"",date:new Date,montant:0},this.paiement={...this.initPaiement},this.idTravail="",this.travail={},this.diagnostics=[],this.affiliations=[],this.services=[],this.servicesDropdownList=[],this.mecanicienDropdownList=[],this.selectedService=[],this.selectedMecanicien=[],this.dropdownSettings={}}ngOnInit(){this.activatedRoute.params.subscribe(t=>{this.idTravail=t.id,this.loadTravail(this.idTravail)}),this.dropdownSettings={singleSelection:!1,idField:"item_id",textField:"item_text",selectAllText:"Tout s\xe9l\xe9ctionner",unSelectAllText:"D\xe9selectionner",itemsShowLimit:5,allowSearchFilter:!0}}syncData(){this.diagnostics=this.travail.selectedService,this.affiliations=this.travail.selectedMecanicien,this.servicesDropdownList=this.servicesDropdownList.filter(t=>!this.diagnostics.some(a=>a._id===t.item_id)),this.mecanicienDropdownList=this.mecanicienDropdownList.filter(t=>!this.affiliations.some(a=>a._id===t.item_id))}loadServices(){this.serviceService.getAllServices().subscribe(t=>{this.services=t,this.servicesDropdownList=t.filter(a=>!this.diagnostics.some(i=>i._id===a._id)).map(a=>({item_id:a._id,item_text:a.label}))})}loadMecaniciens(){const t=JSON.parse(sessionStorage.getItem("currentUser"));this.employeeService.getMecanoByGarage(t.idGarage._id).subscribe(a=>{this.mecanicienDropdownList=a.filter(i=>!this.affiliations.some(o=>o._id===i._id)).map(i=>({item_id:i._id,item_text:`${i.nom} ${i.prenom}`}))})}loadTravail(t){this.travailService.getTravailById(t).subscribe(a=>{this.travail=a,this.diagnostics=a.selectedService,this.affiliations=a.selectedMecanicien,this.paiement.idTravail=this.travail._id,this.loadServices(),this.loadMecaniciens()})}addServices(){if(this.serviceError="",console.log("addServices: ",this.selectedService),this.selectedService.length>0){const t=this.selectedService.map(a=>a.item_id);this.travailService.addServicesToTravail(this.travail._id,t).subscribe(a=>{this.travail=a,this.syncData(),this.selectedService=[],alert("Mise a jour r\xe9ussie")},a=>{this.serviceError=a.message})}else this.serviceError="Aucun service choisi"}addMecano(){if(this.mecanoError="",this.selectedMecanicien.length>0){const t=this.selectedMecanicien.map(a=>a.item_id);this.travailService.addMecanoToTravail(this.travail._id,t).subscribe(a=>{this.travail=a,this.syncData(),this.selectedMecanicien=[],alert("Mise a jour r\xe9ussie")},a=>{this.mecanoError=a.message})}else this.mecanoError="Aucun m\xe9canicien choisi"}addPaiement(){this.paiementError="",this.paiement.date&&this.paiement.montant>0?this.paiementService.addPaiement(this.paiement).subscribe(t=>{alert("Sauvegarde r\xe9ussie"),this.paiement={...this.initPaiement},this.loadTravail(this.idTravail)},t=>{this.paiementError=t.message}):this.paiementError="Champ(s) invalid(s)"}test(){console.log("test: ",this.affiliations)}static{this.\u0275fac=function(a){return new(a||n)(e.rXU(h.nX),e.rXU(u.N),e.rXU(g.O),e.rXU(f.l),e.rXU(F))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-manager-details-travaux"]],decls:96,vars:31,consts:[["addPaiementFrom","ngForm"],["addServiceForm","ngForm"],["addMecanoForm","ngForm"],[1,"card","d-flex","justify-content-center"],[1,"card-body","col-x1-12"],[1,"mb-4"],[1,"row"],[1,"col-sm-7"],[1,"card"],[1,"list-group","list-group-flush",2,"font-size","larger"],[1,"list-group-item"],[1,"col-sm-5"],[1,"card-body"],[1,"card-title"],[3,"ngSubmit"],[1,"form-group"],["type","datetime-local","id","date-heure","name","date",1,"form-control",3,"ngModelChange","ngModel"],["type","number","id","montant","name","montant",1,"form-control",3,"ngModelChange","ngModel"],[1,"text","text-danger"],[1,"d-flex","justify-content-end"],["type","submit",1,"btn","btn-primary","text-end"],[1,"col-sm-6"],[1,"col-sm-8"],["id","services","name","services",3,"ngModelChange","placeholder","settings","data","ngModel"],[1,"col-sm-4"],["type","submit",1,"btn","btn-primary"],[1,"card","tbl-card"],[1,"table-responsive"],[1,"table","table-hover","mb-0",2,"font-size","larger"],[1,"text-center"],["id","mecano","name","mecano",3,"ngModelChange","placeholder","settings","data","ngModel"]],template:function(a,i){if(1&a){const o=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"h5",5),e.EFF(3),e.k0s(),e.j41(4,"div",6)(5,"div",7)(6,"div",8)(7,"ul",9)(8,"li",10),e.EFF(9),e.k0s(),e.j41(10,"li",10),e.EFF(11),e.k0s(),e.j41(12,"li",10),e.EFF(13),e.nI1(14,"date"),e.nI1(15,"date"),e.k0s(),e.j41(16,"li",10),e.EFF(17),e.nI1(18,"number"),e.k0s(),e.j41(19,"li",10),e.EFF(20),e.nI1(21,"number"),e.k0s()()()(),e.j41(22,"div",11)(23,"div",8)(24,"div",12)(25,"h5",13),e.EFF(26,"Enregistrer un paiement"),e.k0s(),e.j41(27,"form",14,0),e.bIt("ngSubmit",function(){return e.eBV(o),e.Njj(i.addPaiement())}),e.j41(29,"div",15)(30,"label"),e.EFF(31,"Date de paiement"),e.k0s(),e.j41(32,"input",16),e.mxI("ngModelChange",function(s){return e.eBV(o),e.DH7(i.paiement.date,s)||(i.paiement.date=s),e.Njj(s)}),e.k0s()(),e.j41(33,"div",15)(34,"label"),e.EFF(35,"Montant (Ar)"),e.k0s(),e.j41(36,"input",17),e.mxI("ngModelChange",function(s){return e.eBV(o),e.DH7(i.paiement.montant,s)||(i.paiement.montant=s),e.Njj(s)}),e.k0s()(),e.DNE(37,S,2,1,"p",18),e.j41(38,"div",19)(39,"button",20),e.EFF(40,"Enregistrer"),e.k0s()()()()()()()(),e.j41(41,"div",4)(42,"div",6)(43,"div",21)(44,"h5",5),e.EFF(45,"Services \xe0 effectuer"),e.k0s(),e.j41(46,"div")(47,"form",14,1),e.bIt("ngSubmit",function(){return e.eBV(o),e.Njj(i.addServices())}),e.j41(49,"div",6)(50,"div",22)(51,"div",15)(52,"ng-multiselect-dropdown",23),e.mxI("ngModelChange",function(s){return e.eBV(o),e.DH7(i.selectedService,s)||(i.selectedService=s),e.Njj(s)}),e.k0s(),e.DNE(53,j,2,1,"p",18),e.k0s()(),e.j41(54,"div",24)(55,"button",25),e.EFF(56,"Ajouter Services"),e.k0s()()()()(),e.j41(57,"div",26)(58,"div",27)(59,"table",28)(60,"thead")(61,"tr")(62,"th"),e.EFF(63,"SERVICE"),e.k0s(),e.j41(64,"th",29),e.EFF(65,"DUREE"),e.k0s(),e.j41(66,"th",29),e.EFF(67,"PRIX"),e.k0s()()(),e.j41(68,"tbody"),e.Z7z(69,T,8,5,"tr",null,e.fX1),e.k0s()()()()(),e.j41(71,"div",21)(72,"div",6)(73,"h5",5),e.EFF(74,"Affiliations"),e.k0s(),e.j41(75,"div")(76,"form",14,2),e.bIt("ngSubmit",function(){return e.eBV(o),e.Njj(i.addMecano())}),e.j41(78,"div",6)(79,"div",22)(80,"div",15)(81,"ng-multiselect-dropdown",30),e.mxI("ngModelChange",function(s){return e.eBV(o),e.DH7(i.selectedMecanicien,s)||(i.selectedMecanicien=s),e.Njj(s)}),e.k0s(),e.DNE(82,b,2,1,"p",18),e.k0s()(),e.j41(83,"div",24)(84,"button",25),e.EFF(85,"Ajouter M\xe9caniciens"),e.k0s()()()()()(),e.j41(86,"div",26)(87,"div",27)(88,"table",28)(89,"thead")(90,"tr")(91,"th"),e.EFF(92,"MECANICIEN"),e.k0s()()(),e.j41(93,"tbody"),e.Z7z(94,C,3,2,"tr",null,e.fX1),e.k0s()()()()()()()()}2&a&&(e.R7$(3),e.SpI("Diagnostic sur le vehicule ",i.travail.matricule,""),e.R7$(6),e.Lme("Client : ",null==i.travail.idClient?null:i.travail.idClient.nom," ",null==i.travail.idClient?null:i.travail.idClient.prenom,""),e.R7$(2),e.SpI("Tel. Client : ",null==i.travail.idClient?null:i.travail.idClient.tel,""),e.R7$(2),e.Lme("Estimation de dur\xe9e : du ",e.i5U(14,21,i.travail.debutTravail,"dd/MM/yyyy \xe0 HH:mm")," jusqu'au ",e.i5U(15,24,i.travail.finEstimation,"dd/MM/yyyy \xe0 HH:mm"),""),e.R7$(4),e.SpI("Prix total : Ar ",e.bMT(18,27,i.travail.prix),""),e.R7$(3),e.SpI("Reste \xe0 payer : Ar ",e.bMT(21,29,i.travail.prix-i.travail.totalPayer),""),e.R7$(12),e.R50("ngModel",i.paiement.date),e.R7$(4),e.R50("ngModel",i.paiement.montant),e.R7$(),e.vxM(i.paiementError?37:-1),e.R7$(15),e.Y8G("placeholder","Services")("settings",i.dropdownSettings)("data",i.servicesDropdownList),e.R50("ngModel",i.selectedService),e.R7$(),e.vxM(i.serviceError?53:-1),e.R7$(16),e.Dyx(i.diagnostics),e.R7$(12),e.Y8G("placeholder","M\xe9canicien")("settings",i.dropdownSettings)("data",i.mecanicienDropdownList),e.R50("ngModel",i.selectedMecanicien),e.R7$(),e.vxM(i.mecanoError?82:-1),e.R7$(12),e.Dyx(i.affiliations))},dependencies:[h.iI,m.MD,m.QX,m.vh,l.YN,l.qT,l.me,l.Q0,l.BC,l.cb,l.vS,l.cV,p.O,p.b],encapsulation:2})}}return n})()}}]);