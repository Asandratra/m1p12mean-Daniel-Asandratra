"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[273],{2273:(y,m,l)=>{l.r(m),l.d(m,{FormTravailComponent:()=>D});var e=l(4438),v=l(5447),u=l(177),c=l(4341),p=l(7482),h=l(8281),g=l(2525),f=l(1626);let C=(()=>{class n{constructor(i){this.httpClient=i,this.apiURL=`${g.c.apiUrl}/services`}getAllServices(){return this.httpClient.get(`${this.apiURL}`)}static{this.\u0275fac=function(s){return new(s||n)(e.KVO(f.Qq))}}static{this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var F=l(3878),M=l(3131);function T(n,d){if(1&n&&(e.j41(0,"p",4),e.EFF(1),e.k0s()),2&n){const i=e.XpG();e.R7$(),e.JRh(i.errorMessage)}}function S(n,d){if(1&n&&(e.j41(0,"p",4),e.EFF(1),e.k0s()),2&n){const i=e.XpG();e.R7$(),e.JRh(i.errorMessage)}}function j(n,d){if(1&n&&(e.j41(0,"option",23),e.EFF(1),e.k0s()),2&n){const i=e.XpG().$implicit;e.Y8G("value",i._id),e.R7$(),e.Lme("",i.nom," ",i.prenom,"")}}function b(n,d){if(1&n&&(e.j41(0,"option",24),e.EFF(1),e.k0s()),2&n){const i=e.XpG().$implicit;e.Y8G("value",i._id),e.R7$(),e.Lme("",i.nom," ",i.prenom,"")}}function _(n,d){if(1&n&&e.DNE(0,j,2,3,"option",23)(1,b,2,3,"option",24),2&n){const i=d.$implicit,s=e.XpG();e.vxM(s.idClient&&i._id.toString()==s.idClient.toString()?0:1)}}let D=(()=>{class n{constructor(i,s,t,o){this.clientService=i,this.serviceService=s,this.employeeService=t,this.travailService=o,this.errorMessage="",this.matricule="",this.isClientConnu=!1,this.clients=[],this.services=[],this.servicesDropdownList=[],this.mecanicienDropdownList=[],this.selectedService=[],this.selectedMecanicien=[],this.dropdownSettings={},this.router=(0,e.WQX)(v.Ix)}ngOnInit(){this.checkClient(),this.loadClients(),this.loadServices(),this.loadMecaniciens(),this.dropdownSettings={singleSelection:!1,idField:"item_id",textField:"item_text",selectAllText:"Tout s\xe9l\xe9ctionner",unSelectAllText:"D\xe9selectionner",allowSearchFilter:!0}}checkClient(){this.idClient="";const i=JSON.parse(sessionStorage.getItem("clientDeTravail"));i&&(this.idClient=i._id,sessionStorage.removeItem("clientDeTravail"))}loadClients(){this.clientService.getAllClient().subscribe(i=>{this.clients=i})}loadServices(){this.serviceService.getAllServices().subscribe(i=>{this.services=i,this.servicesDropdownList=i.map(s=>({item_id:s._id,item_text:s.label}))})}loadMecaniciens(){const i=JSON.parse(sessionStorage.getItem("currentUser"));this.employeeService.getMecanoByGarage(i.idGarage._id).subscribe(s=>{this.mecanicienDropdownList=s.map(t=>({item_id:t._id,item_text:`${t.nom} ${t.prenom}`}))})}checkTravailForm(){return this.idClient&&""!==this.matricule&&this.debutTravail&&new Date(this.debutTravail)>new Date&&this.selectedService.length>0&&this.selectedMecanicien.length>0}processData(){const i=JSON.parse(sessionStorage.getItem("currentUser")),s=this.selectedService.map(a=>a.item_id),t=this.selectedMecanicien.map(a=>a.item_id);let o=0;for(let a of this.selectedService){const r=this.services.find(R=>R._id===a.item_id);r&&(o+=r.prix)}return{idClient:this.idClient,matricule:this.matricule,idGarage:i.idGarage._id,debutTravail:this.debutTravail,prix:o,selectedService:s,selectedMecanicien:t}}createTravail(){if(this.errorMessage="",this.checkTravailForm()){const i=this.processData();this.travailService.createTravail(i).subscribe(s=>{alert("Sauvegarde r\xe9ussi!"),this.router.navigateByUrl("manager/travaux/1")},s=>{this.errorMessage=s.message})}}test(){console.log("test: ",this.selectedService)}static{this.\u0275fac=function(s){return new(s||n)(e.rXU(h.X),e.rXU(C),e.rXU(F.O),e.rXU(M.l))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-form-travail"]],decls:37,vars:13,consts:[["createTravailForm","ngForm"],[1,"card","d-flex","justify-content-center"],[1,"card-body","col-x1-12"],[1,"mb-4"],[1,"text","text-danger"],[1,"tbl-card"],[3,"ngSubmit"],[1,"row"],[1,"col-sm-5"],[1,"form-group","mb-3"],["for","role"],["id","client","name","client","aria-label","Selection du client",1,"form-select",3,"ngModelChange","ngModel"],[1,"form-group"],["for","matricule"],["type","text","id","matricule","placeholder","exemple: 1234 TA","name","matricule",1,"form-control",3,"ngModelChange","ngModel"],["for","debut"],["type","datetime-local","id","debut","name","debut",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-sm-7"],["for","exampleFormControlSelect2"],["id","services","name","services",3,"ngModelChange","placeholder","settings","data","ngModel"],["id","employees","name","employees",3,"ngModelChange","placeholder","settings","data","ngModel"],[1,"d-flex"],["type","submit",1,"btn","btn-primary"],["selected","",3,"value"],[3,"value"]],template:function(s,t){if(1&s){const o=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"h5",3),e.EFF(3,"Nouveau Travail"),e.k0s(),e.DNE(4,T,2,1,"p",4),e.j41(5,"div",5)(6,"form",6,0),e.bIt("ngSubmit",function(){return e.eBV(o),e.Njj(t.createTravail())}),e.j41(8,"div",7)(9,"div",8),e.DNE(10,S,2,1,"p",4),e.j41(11,"div",9)(12,"label",10),e.EFF(13,"Client"),e.k0s(),e.j41(14,"select",11),e.mxI("ngModelChange",function(r){return e.eBV(o),e.DH7(t.idClient,r)||(t.idClient=r),e.Njj(r)}),e.Z7z(15,_,2,1,null,null,e.fX1),e.k0s()(),e.j41(17,"div",12)(18,"label",13),e.EFF(19,"Matricule du vehicule"),e.k0s(),e.j41(20,"input",14),e.mxI("ngModelChange",function(r){return e.eBV(o),e.DH7(t.matricule,r)||(t.matricule=r),e.Njj(r)}),e.k0s()(),e.j41(21,"div",12)(22,"label",15),e.EFF(23,"Date de d\xe9but"),e.k0s(),e.j41(24,"input",16),e.mxI("ngModelChange",function(r){return e.eBV(o),e.DH7(t.debutTravail,r)||(t.debutTravail=r),e.Njj(r)}),e.k0s()()(),e.j41(25,"div",17)(26,"div",12)(27,"label",18),e.EFF(28,"Services \xe0 effectuer"),e.k0s(),e.j41(29,"ng-multiselect-dropdown",19),e.mxI("ngModelChange",function(r){return e.eBV(o),e.DH7(t.selectedService,r)||(t.selectedService=r),e.Njj(r)}),e.k0s()(),e.j41(30,"div",12)(31,"label",18),e.EFF(32,"Mecaniciens \xe0 affilier"),e.k0s(),e.j41(33,"ng-multiselect-dropdown",20),e.mxI("ngModelChange",function(r){return e.eBV(o),e.DH7(t.selectedMecanicien,r)||(t.selectedMecanicien=r),e.Njj(r)}),e.k0s()()()(),e.j41(34,"div",21)(35,"button",22),e.EFF(36,"Valider"),e.k0s()()()()()()}2&s&&(e.R7$(4),e.vxM(t.errorMessage?4:-1),e.R7$(6),e.vxM(t.errorMessage?10:-1),e.R7$(4),e.R50("ngModel",t.idClient),e.R7$(),e.Dyx(t.clients),e.R7$(5),e.R50("ngModel",t.matricule),e.R7$(4),e.R50("ngModel",t.debutTravail),e.R7$(5),e.Y8G("placeholder","Services")("settings",t.dropdownSettings)("data",t.servicesDropdownList),e.R50("ngModel",t.selectedService),e.R7$(4),e.Y8G("placeholder","Mecaniciens")("settings",t.dropdownSettings)("data",t.mecanicienDropdownList),e.R50("ngModel",t.selectedMecanicien))},dependencies:[v.iI,u.MD,c.YN,c.qT,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.vS,c.cV,p.O,p.b],encapsulation:2})}}return n})()}}]);